import{customElementsPrefix,extensionName}from"../../Defines.js";import{ExtendedInfoOfSlave}from"../../ExtendedInfo.js";import{Master}from"../../Master.js";import{Notifications,NotificationLevel}from"../../Notifications.js";import{Slave}from"../../Slave.js";export var AdsState;!function(AdsState){AdsState[AdsState.run=5]="run",AdsState[AdsState.config=15]="config"}(AdsState||(AdsState={}));export class SlaveListView extends HTMLElement{constructor(master,localization){if(super(),!master||!localization)throw new Error("Required parameters `master` and `localization` are missing or undefined. The constructor is probably called by document.createElement() or the html tag and therefore no parameters were passed.");this.__master=master,this.__ecdiagnostics=master.main,this.__releaseAllProcessDataBtn=this.__ecdiagnostics.createStatusButton("Slave_Processdata_Release_All"),this.__localization=localization,this.__preInit()}__forcedStateElements=new Map;__forceStateInfo=document.createElement("span");__releaseAllNotAvailableInfo=document.createElement("div");__releaseAllProcessDataBtn;__listViewWrapper=document.createElement("div");updateForcedStates=data=>{let slaveCounterWithForcedProcessData=0;for(const[addr,slave]of this.__master.slaves){const el=this.__forcedStateElements.get(addr);el&&(slave.hasForcedProcessData?(slaveCounterWithForcedProcessData++,el.classList.toggle("hide",!1)):el.classList.toggle("hide",!0))}const el=this.__forcedStateElements.get("master");el&&el.classList.toggle("hide",!this.__master.hasForcedProcessData),this.__master.hasForcedProcessData?(this.__localization.addElement(this.__forceStateInfo,"Msg_Process_Data_Forced_At_N_Slaves",[slaveCounterWithForcedProcessData]),this.__releaseAllProcessDataBtn.removeAttribute("disabled")):(this.__localization.addElement(this.__forceStateInfo,"Msg_Process_Data_Nothing_Forced",[slaveCounterWithForcedProcessData]),this.__releaseAllProcessDataBtn.setAttribute("disabled","true"))};connectedCallback(){this.__master.forcedProcessDataCbs.add(this.updateForcedStates),this.__init(),this.__master.target.addTargetSysServiceAdsStateOnChangeFn(this.__onTargetAdsSysServiceChange)}disconnectedCallback(){this.__master.forcedProcessDataCbs.delete(this.updateForcedStates),this.__localization.cleanUp(),this.__master.target.removeTargetSysServiceAdsStateOnChangeFn(this.__onTargetAdsSysServiceChange)}__onTargetAdsSysServiceChange=targetSysServiceAdsState=>{if(this.__releaseAllNotAvailableInfo.textContent="",this.__master.main.getSymbolAccess(`${extensionName}.ReleaseProcessDataValues`)&&targetSysServiceAdsState!==AdsState.run){const errElement=Notifications.createErrorElement(this.__master.main,this.__localization,"{{Msg_Process_Data_Forcing_And_Releasing_Only_Available_In_Run_Mode}}",NotificationLevel.warning);errElement.style.maxWidth="300px",this.__releaseAllNotAvailableInfo.append(errElement)}};__preInit(){this.__listViewWrapper.classList.add("list-view-wrapper");const releaseAllWrapper=document.createElement("div");releaseAllWrapper.classList.add("release-all-wrapper"),this.__releaseAllNotAvailableInfo.classList.add("release-all-not-available-info"),this.__forceStateInfo.classList.add("force-state-info"),releaseAllWrapper.append(this.__releaseAllProcessDataBtn,this.__forceStateInfo,this.__releaseAllNotAvailableInfo),this.append(releaseAllWrapper,document.createElement("hr"),this.__listViewWrapper)}__init(){this.__releaseAllProcessDataBtn.addEventListener("click",()=>{this.__master.target.main.comObj?.writeSymbol(`${extensionName}.ReleaseProcessDataValues`,this.__master.main.config.device,()=>{},{button:this.__releaseAllProcessDataBtn})}),this.__addSlaveList()}__addSlaveList(){this.__listViewWrapper.textContent="",this.__forcedStateElements=new Map;const cellSlaveForcedStateHeader=document.createElement("div");cellSlaveForcedStateHeader.classList.add("entry-cell","first","forced-process-data-value-flag-placeholder");const cellSlaveNameHeader=document.createElement("div");this.__localization.addElement(cellSlaveNameHeader,"Name"),cellSlaveNameHeader.classList.add("entry-cell","bold");const cellSlaveTypeHeader=document.createElement("div");this.__localization.addElement(cellSlaveTypeHeader,"Type"),cellSlaveTypeHeader.classList.add("entry-cell","bold");const cellSlavePhyAddrHeader=document.createElement("div");this.__localization.addElement(cellSlavePhyAddrHeader,"Slave_View_EtherCAT_General_EtherCAT_Addr"),cellSlavePhyAddrHeader.classList.add("entry-cell","bold"),this.__listViewWrapper.append(cellSlaveForcedStateHeader,cellSlaveNameHeader,cellSlaveTypeHeader,cellSlavePhyAddrHeader);const masterTopologySlaves=this.__master.topology?.componentOrder;if(masterTopologySlaves)for(const component of masterTopologySlaves)this.__insertComponentEntry(component);const hcTopologies=this.__master.network.getHotConnectTopologies();if(hcTopologies.length>0){const cellNotConnectHCGroupHeader=document.createElement("div");this.__localization.addElement(cellNotConnectHCGroupHeader,"Not_Connected_Hot_Connect_Groups"),cellNotConnectHCGroupHeader.classList.add("entry-cell","grid-full-row","bold"),this.__listViewWrapper.append(cellNotConnectHCGroupHeader);for(const topology of hcTopologies){topology.calcNetwork();for(const component of topology.componentOrder)this.__insertComponentEntry(component)}}const disabledTopologies=this.__master.network.getDisabledSlaves();if(disabledTopologies.length>0){const cellDisabledSlavesHeader=document.createElement("div");this.__localization.addElement(cellDisabledSlavesHeader,"Disabled_Slaves"),cellDisabledSlavesHeader.classList.add("entry-cell","grid-full-row","bold"),this.__listViewWrapper.append(cellDisabledSlavesHeader);for(const topology of disabledTopologies){topology.calcNetwork();for(const component of topology.componentOrder)this.__insertComponentEntry(component)}}this.updateForcedStates([])}__insertComponentEntry(component){const cellForcedState=document.createElement("div");cellForcedState.classList.add("entry-cell","first"),this.__listViewWrapper.append(cellForcedState);const forcedProcessDataValueFlag=document.createElement("span");if(forcedProcessDataValueFlag.classList.add("forced-process-data-value-flag","hide"),forcedProcessDataValueFlag.textContent="F",this.__localization.addElement(forcedProcessDataValueFlag,void 0,void 0,new Map([["title",{contentKey:"Component_At_Least_One_Forced_Process_Data",placeholders:[component.constructor.name]}]])),cellForcedState.append(forcedProcessDataValueFlag),component instanceof Master){this.__forcedStateElements.set("master",forcedProcessDataValueFlag);const cellMasterName=document.createElement("div");cellMasterName.classList.add("entry-cell","grid-second-col-till-end","bold"),cellMasterName.textContent=component.name,this.__listViewWrapper.append(cellMasterName)}else if(component instanceof Slave){this.__forcedStateElements.set(component.addr,forcedProcessDataValueFlag);const cellSlaveName=document.createElement("div");cellSlaveName.textContent=component.identity.name.value,cellSlaveName.classList.add("entry-cell","navigation-link"),cellSlaveName.addEventListener("click",()=>{this.__master.setExtendedInfoOfSlave(new ExtendedInfoOfSlave(component))});const cellSlaveType=document.createElement("div");cellSlaveType.textContent=component.identity.type.value??"",cellSlaveType.classList.add("entry-cell");const cellSlavePhysAddr=document.createElement("div");cellSlavePhysAddr.textContent=component.identity.addrs.phys.toString(),cellSlavePhysAddr.classList.add("entry-cell"),this.__listViewWrapper.append(cellSlaveName,cellSlaveType,cellSlavePhysAddr)}}__ecdiagnostics;__master;__localization}customElements.define(customElementsPrefix+"slave-list-view",SlaveListView);