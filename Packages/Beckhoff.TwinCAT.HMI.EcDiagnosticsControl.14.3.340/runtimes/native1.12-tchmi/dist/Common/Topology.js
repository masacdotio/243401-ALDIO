import{Master}from"./Master.js";import{Slave}from"./Slave.js";import{Trace}from"./Trace.js";export class Topology{constructor(network,firstData,type){this.__network=network,this.__topologyType=type,type===TopologyType.master&&firstData instanceof Master?this.__firstComponent=firstData:type===TopologyType.hotConnect||type===TopologyType.disabled?this.__firstComponent=new Slave(firstData,new Trace(this),null,null,[]):TcHmi.Log.error("Topology and firstData type mismatch.")}__firstComponent;__network;get network(){return this.__network}get master(){return this.network.master}__topologyType;__matrixDesign={margin:50,marginRows:{top:150,bottom:75}};__matrixComponentOrder=[];get componentOrder(){return this.__matrixComponentOrder}__matrixRows=[];get matrixRows(){return this.__matrixRows}addRow(index,startDimension){const newRow={index,height:startDimension.height,width:startDimension.width,yOffset:0};this.__matrixRows.splice(index,0,newRow);for(let rowIndex=newRow.index+1;rowIndex<this.__matrixRows.length;rowIndex++)this.__matrixRows[rowIndex].index++;return newRow}__matrixDimension={width:0,height:0};get matrixDimension(){return this.__matrixDimension}__chronologicalPortList=[];get chronologicalPortList(){return this.__chronologicalPortList}addPortToChronologicalPortList(port){this.__chronologicalPortList.push(port)}__traces=[];get traces(){return this.__traces}addTrace(){const trace=new Trace(this);return this.__traces.push(trace),trace}calcNetwork(){if(!this.__firstComponent)return void TcHmi.Log.error("First component of topology is not defined.");this.__matrixRows=[],this.__matrixComponentOrder=[];const newRow=this.addRow(0,this.__firstComponent.design.dimension),coordinates={col:this.__matrixDesign.margin,row:newRow};this.__firstComponent.startCoordinates=coordinates,this.__topologyType!==TopologyType.disabled?this.__firstComponent.follow(0):this.__matrixComponentOrder.push(this.__firstComponent)}calcMatrix(){this.__matrixDimension={width:0,height:0},this.__matrixDimension.height+=this.__matrixDesign.margin;for(const row of this.__matrixRows)this.__matrixDimension.height+=this.__matrixDesign.marginRows.top,row.yOffset=this.__matrixDimension.height,this.__matrixDimension.height+=row.height,this.__matrixDimension.height+=this.__matrixDesign.marginRows.bottom,this.__matrixDimension.width=Math.max(this.__matrixDimension.width,row.width);this.__matrixDimension.width+=2*this.__matrixDesign.margin,this.__matrixDimension.height+=this.__matrixDesign.margin}groupAllTerminalGroups(){for(const trace of this.__traces)trace.groupSlaveTerminalGroups()}ungroupAllTerminalGroups(){for(const trace of this.__traces)trace.ungroupSlaveTerminalGroups()}hasGroupedSlaves(){for(const trace of this.__traces)if(trace.hasGroupedSlaves())return!0;return!1}}export var TopologyType;!function(TopologyType){TopologyType[TopologyType.master=0]="master",TopologyType[TopologyType.hotConnect=1]="hotConnect",TopologyType[TopologyType.disabled=2]="disabled"}(TopologyType||(TopologyType={}));export var TopologyView;!function(TopologyView){TopologyView[TopologyView.None=-1]="None",TopologyView[TopologyView.Target=0]="Target",TopologyView[TopologyView.Master=1]="Master",TopologyView[TopologyView.Network=2]="Network",TopologyView[TopologyView.Trace=3]="Trace",TopologyView[TopologyView.Slave=4]="Slave"}(TopologyView||(TopologyView={}));