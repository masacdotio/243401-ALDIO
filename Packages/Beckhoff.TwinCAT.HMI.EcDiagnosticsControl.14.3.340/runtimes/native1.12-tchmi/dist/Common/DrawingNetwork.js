import{DrawingInteraction}from"./DrawingInteraction.js";import{TopologyView}from"./Topology.js";import{LayerName}from"./Layer.js";import{PortOrientation,PortStates}from"./Port.js";import{Master}from"./Master.js";import{Slave}from"./Slave.js";import{SlaveTerminalGroup}from"./SlaveGroup.js";import{store}from"./Appearance.js";import{ColorRGBA_White}from"./Color.js";import{ExtendedInfoOfSlave,ExtendedInfoOfMaster}from"./ExtendedInfo.js";import{customElementsPrefix}from"./Defines.js";export function createElementAndAddText(elementType,content){const element=document.createElement(elementType);return element.textContent=content,element}export class DrawingNetwork extends DrawingInteraction{constructor(main,network,redrawFn){if(!main)throw new Error("Required parameter `main` is missing or undefined. The constructor is probably called by document.createElement() or the html tag and therefore no parameters were passed.");super(main,network?.master,TopologyView.Network,void 0,redrawFn),this.__network=network,this.classList.add("network-view");const toolbox=document.createElement("div");toolbox.classList.add("toolbox"),this.__toolboxResetViewButton=document.createElement("button"),this.__toolboxResetViewButton.classList.add("toolbox-reset-view","hide"),toolbox.append(this.__toolboxResetViewButton),this.__drawingInfo.classList.add("drawing-info"),this.prepend(toolbox,this.__drawingInfo)}__toolboxResetViewButton;init(master,redrawnFn){super.__deinit(),this.__master=master,this.__network=master.network,this.__redrawFn=redrawnFn,this.resetView();const{allowZoomAndPan,toolboxResetView}=this.__main.config,showToolboxResetViewButton=allowZoomAndPan&&toolboxResetView;this.__toolboxResetViewButton.classList.toggle("hide",!showToolboxResetViewButton),showToolboxResetViewButton&&this.__toolboxResetViewButton.addEventListener("click",this.resetView),super.__init()}deinit(){this.__toolboxResetViewButton.removeEventListener("click",this.resetView),this.__userInteracted=!1,super.__deinit()}disconnectedCallback(){}__network;get network(){return this.__network}get master(){return this.__master}initDrawing(){super.initDrawing(),this.preDrawingEvent()}resetView=()=>{const config=this.__main.config;super.resetView(config.initTopologyViewPosX,config.initTopologyViewPosY,config.initTopologyViewZoom)};drawCableLinkConnectionOrientation(outputPort,layers){if(!store.appearance)return void TcHmi.Log.error("Appearance is null.");layers.saveContext();const ctx=layers.getContext(LayerName.processData);ctx.lineWidth=15;const pos=outputPort.pos.rel,componentDimension=outputPort.component.design.dimension;if(ctx.beginPath(),!outputPort.connection?.inPort)return void TcHmi.Log.error("input port unknown");const ports={input:outputPort.connection.inPort,output:outputPort};ports.input.hotConnectGroupStart&&ctx.setLineDash([50,10]),ctx.moveTo(pos.x,pos.y);let posEnd={x:0,y:0};switch(outputPort.orientation){case PortOrientation.right:posEnd={x:-pos.x+componentDimension.width+100+50,y:pos.y};break;case PortOrientation.up:posEnd={x:pos.x,y:-pos.y-100};break;case PortOrientation.down:posEnd={x:pos.x,y:-pos.y+componentDimension.height+100};break;default:return void TcHmi.Log.error(`Invalid ouput-port orientation '${outputPort.orientation}' while drawing cableLinkConnectionOrientation.`)}const connectionState=Math.max(ports.input.state,ports.output.state);if(ctx.strokeStyle=this.__getConnectionOrientationGradient(ctx,pos,posEnd,connectionState),ctx.lineTo(posEnd.x,posEnd.y),ctx.stroke(),ports.output.redundancyPath){const gradRedundancy=ctx.createLinearGradient(pos.x,pos.y,posEnd.x,posEnd.y);gradRedundancy.addColorStop(0,ColorRGBA_White.getRGBAString(.7)),gradRedundancy.addColorStop(1,ColorRGBA_White.getRGBAString(.1)),ctx.strokeStyle=gradRedundancy,ctx.lineWidth=6,ctx.stroke()}layers.restoreContext()}drawCableLinkConnectionRedundancyOrientation(inputPort,layers){if(!store.appearance)return void TcHmi.Log.error("Appearance is null.");const ctx=layers.getContext(LayerName.processData);layers.saveContext(),ctx.lineWidth=15;const pos=inputPort.pos.network,component=inputPort.component,componentDimension=component.design.dimension;if(ctx.beginPath(),!inputPort.connection?.inPort)return void TcHmi.Log.error("input port unknown");const ports={input:inputPort,output:inputPort.connection.outPort};ports.input.hotConnectGroupStart&&ctx.setLineDash([50,10]),ctx.moveTo(pos.x,pos.y),ctx.lineTo(pos.x-50,pos.y);const posEnd={x:pos.x-50,y:0};switch(ports.output.orientation){case PortOrientation.right:posEnd.y=component.networkPos.y+componentDimension.height+100;break;case PortOrientation.up:posEnd.y=component.networkPos.y-100;break;case PortOrientation.down:posEnd.y=component.networkPos.y+componentDimension.height+100;break;default:TcHmi.Log.error(`Unknown output-port orientation '${ports.output.orientation}' while drawing CableLinkConnectionRedundancyOrientation.`)}const connectionState=Math.max(ports.input.state,ports.output.state);if(ctx.strokeStyle=this.__getConnectionOrientationGradient(ctx,pos,posEnd,connectionState),ctx.lineTo(posEnd.x,posEnd.y),ctx.stroke(),ports.output.redundancyPath){const gradRedundancy=ctx.createLinearGradient(pos.x,pos.y,posEnd.x,posEnd.y);gradRedundancy.addColorStop(0,"rgba(255, 255, 255, 0.7)"),gradRedundancy.addColorStop(1,"rgba(255, 255, 255, 0.1)"),ctx.strokeStyle=gradRedundancy,ctx.lineWidth=6,ctx.stroke()}layers.restoreContext()}__getConnectionOrientationGradient(ctx,posStart,posEnd,connectionState){const grad=ctx.createLinearGradient(posStart.x,posStart.y,posEnd.x,posEnd.y);if(!store.appearance)return TcHmi.Log.error("Appearance is null."),grad;switch(connectionState){case PortStates.notInitialized:case PortStates.notPresent:grad.addColorStop(0,store.appearance.cable.notPresent.strokeColor.getRGBAString(.5)),grad.addColorStop(1,store.appearance.cable.notPresent.strokeColor.getRGBAString(0));break;case PortStates.noError:grad.addColorStop(0,store.appearance.cable.noError.strokeColor.getRGBAString()),grad.addColorStop(1,store.appearance.cable.noError.strokeColor.getRGBAString(0));break;case PortStates.error:grad.addColorStop(0,store.appearance.cable.error.strokeColor.getRGBAString()),grad.addColorStop(1,store.appearance.cable.error.strokeColor.getRGBAString(0));break;default:TcHmi.Log.error(`Unknown connection state '${connectionState}'`)}return grad}drawCableLinkConnection(inputPort,layers){if(!store.appearance)return void TcHmi.Log.error("Appearance is null.");const ctx=layers.getContext(LayerName.processData);if(layers.saveContext(),inputPort&&inputPort.connection){inputPort.hotConnectGroupStart&&ctx.setLineDash([50,10]);const ports={input:inputPort,output:inputPort.connection.outPort},inputComponentPos=ports.input.component.networkPos,outputComponentPos=ports.output.component.networkPos,outputPortPos={x:outputComponentPos.x-inputComponentPos.x+ports.output.pos.rel.x,y:outputComponentPos.y-inputComponentPos.y+ports.output.pos.rel.y};ctx.lineWidth=15;const pos={input:ports.input.pos.rel,output:outputPortPos};ctx.beginPath(),ctx.moveTo(pos.output.x,pos.output.y),ports.output.orientation===PortOrientation.right?(ctx.lineTo(pos.output.x+100,pos.output.y),ctx.lineTo(pos.output.x+100,pos.input.y)):ctx.lineTo(pos.output.x,pos.input.y),ctx.lineTo(pos.input.x,pos.input.y);const connectionState=Math.max(ports.input.state,ports.output.state);switch(connectionState){case PortStates.notInitialized:case PortStates.notPresent:ctx.strokeStyle=store.appearance.cable.notPresent.strokeColor.getRGBAString();break;case PortStates.noError:ctx.strokeStyle=store.appearance.cable.noError.strokeColor.getRGBAString();break;case PortStates.error:const grad=ctx.createLinearGradient(pos.output.x,pos.output.y,pos.input.x,pos.input.y);grad.addColorStop(0,store.appearance.cable.error.strokeColor.getRGBAString()),grad.addColorStop(1,store.appearance.cable.error.strokeColor.getRGBAString(.1)),ctx.strokeStyle=grad;break;default:TcHmi.Log.error(`Invalid connection state ${connectionState}`)}ctx.stroke(),ports.output.redundancyPath&&(ctx.strokeStyle="rgba(255, 255, 255, 0.7)",ctx.lineWidth=6,ctx.stroke())}layers.restoreContext()}drawCableLinkConnectionRedundancy(inputPort,layers){if(!store.appearance)return void TcHmi.Log.error("Appearance is null.");layers.saveContext();const ctx=layers.getContext(LayerName.processData);if(inputPort&&inputPort.connection){const ports={input:inputPort,output:inputPort.connection.outPort};if(!ports.input)return;if(ctx.lineWidth=15,ports.output.component instanceof Slave){const outputSlave=ports.output.component;if(outputSlave.visibility){const pos={input:ports.input.pos.network,output:ports.output.pos.network},rowHeight=outputSlave.trace?.pos?.row.height;if(!rowHeight)return void TcHmi.Log.error("unable to get row height");ctx.beginPath(),ctx.moveTo(pos.output.x,pos.output.y);let rowLineY=pos.output.y;switch(ports.output.orientation){case PortOrientation.right:const behindComponentX=outputSlave.networkPos.x+outputSlave.design.dimension.width+50;ctx.lineTo(behindComponentX,pos.output.y),rowLineY=ports.output.component.networkPos.y+rowHeight+100,ctx.lineTo(behindComponentX,rowLineY),ctx.lineTo(pos.input.x-50,rowLineY),ctx.lineTo(pos.input.x-50,pos.input.y);break;case PortOrientation.up:rowLineY=ports.output.component.networkPos.y-150,ctx.lineTo(pos.output.x,rowLineY),ctx.lineTo(pos.input.x-50,rowLineY),ctx.lineTo(pos.input.x-50,pos.input.y);break;case PortOrientation.down:rowLineY=ports.output.component.networkPos.y+rowHeight+100,ctx.lineTo(pos.output.x,rowLineY),ctx.lineTo(pos.input.x-50,rowLineY),ctx.lineTo(pos.input.x-50,pos.input.y);break;default:TcHmi.Log.error(`Invalid output-port-orientation '${ports.output.orientation}' while drawing CableLinkConnectionRedundancy.`)}ctx.lineTo(pos.input.x,pos.input.y);const connectionState=Math.max(ports.input.state,ports.output.state);switch(connectionState){case PortStates.notInitialized:case PortStates.notPresent:ctx.strokeStyle=store.appearance.cable.notPresent.strokeColor.getRGBAString();break;case PortStates.noError:ctx.strokeStyle=store.appearance.cable.noError.strokeColor.getRGBAString();break;case PortStates.error:const grad=ctx.createLinearGradient(pos.output.x,pos.output.y,pos.input.x,pos.input.y);grad.addColorStop(0,store.appearance.cable.error.strokeColor.getRGBAString()),grad.addColorStop(1,store.appearance.cable.error.strokeColor.getRGBAString(.1)),ctx.strokeStyle="#FF0000",ctx.strokeStyle=grad;break;default:TcHmi.Log.error(`Invalid connection state '${connectionState}'.`)}ctx.stroke(),ctx.strokeStyle="rgba(255, 255, 255, 0.7)",ctx.lineWidth=6,ctx.stroke()}else this.drawCableLinkConnectionRedundancyOrientation(inputPort,layers)}}layers.restoreContext()}drawComponent(component,layers){component instanceof Slave?this.drawSlave(component,layers):component instanceof Master?this.drawMaster(component,layers):component instanceof SlaveTerminalGroup&&this.drawSlaveTerminalGroup(component,layers)}drawSlave(slave,layers){if(!store.appearance)return void TcHmi.Log.error("Appearance is null.");layers.saveContext(),this.__translateOrigin(layers,slave.networkPos);const dimension=slave.design.dimension;let drawingDimension;(slave.numOfOutgoingConfiguredCableLinkPorts>0||slave.hasOutgoingConfiguredEBusPort)&&!slave.expansion&&(drawingDimension={width:dimension.width+100,height:dimension.height}),super.drawSlave(slave,layers,drawingDimension);let contextMenuFn,hoverText=slave.name;if(slave.numOfCableLinkPorts>0)(slave.numOfOutgoingConfiguredCableLinkPorts>0||slave.hasOutgoingConfiguredEBusPort)&&(contextMenuFn=()=>{this.__userInteracted=!0,slave.toggleExpansion(),slave.network.recalcNetwork(slave)},slave.numOfSubSlaves>0&&(slave.expansion?hoverText+="{{Tooltip_Slave_Pointer_Secondary_Interaction_Collapse_Ports_Of_Coupler.margin-top-20}}":hoverText+="{{Tooltip_Slave_Pointer_Secondary_Interaction_Expand_Ports_Of_Coupler.margin-top-20}}"));else{const slaveTerminalGroup=slave.slaveTerminalGroup;if(!slaveTerminalGroup)return;contextMenuFn=()=>{this.__userInteracted=!0,slaveTerminalGroup.group(),slave.network.recalcNetwork(slave)},hoverText+="{{Tooltip_Slave_Pointer_Secondary_Interaction_Collapse_EBus_Group.margin-top-20}}"}this.__addEventTarget({dimension,target:slave,hoverText,primaryPointerFn:function(){slave.master.setExtendedInfoOfSlave(new ExtendedInfoOfSlave(slave))},secondaryPointerFn:contextMenuFn}),0===slave.pos.networkTraceXOffset&&this.__drawTraceFlag(slave,{x:-5,y:-120},layers);const inputPort=slave.ports[0];if(inputPort.isCableLink&&this.drawCableLinkConnection(inputPort,layers),!slave.expansion){for(const port of slave.outgoingConfiguredCableLinkPorts)port.redundancy||this.drawCableLinkConnectionOrientation(port,layers);this.drawSlaveCouplerGroup(slave,layers)}const selectedSyncUnitId=this.__master?.selectedSyncUnit,slaveSyncUnits=slave.syncUnitIds;if(null!=selectedSyncUnitId&&slaveSyncUnits&&slaveSyncUnits.includes(selectedSyncUnitId)){const ctx=layers.getContext(LayerName.syncUnit),syncUnitOnline=slave.data.online.syncUnits.get(selectedSyncUnitId);syncUnitOnline?syncUnitOnline.error.value?(ctx.strokeStyle=store.appearance.slave.syncUnitHighlight.error.frame.border.color.getRGBAString(),ctx.lineWidth=store.appearance.slave.syncUnitHighlight.error.frame.border.width):syncUnitOnline.faultCounter&&syncUnitOnline.faultCounter.value&&syncUnitOnline.faultCounter.value>0?(ctx.strokeStyle=store.appearance.slave.syncUnitHighlight.warning.frame.border.color.getRGBAString(),ctx.lineWidth=store.appearance.slave.syncUnitHighlight.warning.frame.border.width):(ctx.strokeStyle=store.appearance.slave.syncUnitHighlight.noError.frame.border.color.getRGBAString(),ctx.lineWidth=store.appearance.slave.syncUnitHighlight.noError.frame.border.width):ctx.strokeStyle="black",ctx.strokeRect(0,0,dimension.width,dimension.height)}this.__revertOriginTranslation(layers),layers.restoreContext()}__drawTraceFlag(slave,traceLabelPos,layers){if(!store.appearance)return void TcHmi.Log.error("Appearance is null.");const trace=slave.trace,ctxText=layers.getContext(LayerName.text);ctxText.font=`40px ${store.appearance.fontFamily}`;let text=slave.name,hoverText="";const hasGroupedSlaves=trace.hasGroupedSlaves();slave.expansion&&trace.hasSlaveTerminalGroups()&&(!0===hasGroupedSlaves?(text=" + "+text,hoverText=`{{Tooltip_Trace_Pointer_Primary_Interaction_Expand_EBus_Groups$${slave.name}}}`):!1===hasGroupedSlaves&&(text=" - "+text,hoverText=`{{Tooltip_Trace_Pointer_Primary_Interaction_Collapse_EBus_Groups$${slave.name}}}`));const labelDimension={width:ctxText.measureText(text).width+40,height:58},traceLabelBgPos={x:traceLabelPos.x,y:traceLabelPos.y-10},slaveHeight=slave.design.dimension.height,ctxTraceLabelBg=layers.getContext(LayerName.text);if(ctxTraceLabelBg.beginPath(),ctxTraceLabelBg.fillStyle=store.appearance.trace.label.bgColor.getRGBAString(),ctxTraceLabelBg.clearRect(traceLabelBgPos.x-50,traceLabelBgPos.y,500,labelDimension.height+2),ctxText.clearRect(traceLabelBgPos.x-50,traceLabelBgPos.y,500,labelDimension.height+2),ctxTraceLabelBg.lineWidth=4,ctxTraceLabelBg.rect(traceLabelBgPos.x,traceLabelBgPos.y,labelDimension.width,labelDimension.height),ctxTraceLabelBg.fill(),ctxTraceLabelBg.beginPath(),ctxTraceLabelBg.moveTo(traceLabelBgPos.x+ctxTraceLabelBg.lineWidth/2,traceLabelBgPos.y),ctxTraceLabelBg.lineTo(traceLabelBgPos.x+ctxTraceLabelBg.lineWidth/2,slaveHeight),ctxTraceLabelBg.stroke(),null!==hasGroupedSlaves){const clkfn=()=>{this.__userInteracted=!0;const trace=slave.trace;trace.toggleSlaveTerminalGroups(),trace.network.recalcNetwork()};this.__addEventTarget({relativePos:traceLabelBgPos,dimension:labelDimension,target:slave,hoverText,primaryPointerFn:clkfn})}if(ctxText.textBaseline="top",ctxText.fillStyle=store.appearance.trace.label.textColor.getRGBAString(),ctxText.fillText(text,traceLabelPos.x+20,traceLabelPos.y),slave.data.EtherCAT.hotConnect.isHotConnectHead){ctxTraceLabelBg.beginPath(),ctxTraceLabelBg.fillStyle=store.appearance.trace.label.bgColor.getRGBAString();const pos={x:-78,y:slaveHeight-70},dimension={width:73,height:70};ctxTraceLabelBg.rect(pos.x,pos.y,dimension.width,dimension.height),ctxTraceLabelBg.fill(),ctxText.fillStyle=store.appearance.trace.label.textColor.getRGBAString(),ctxText.fillText("HC",-70,slaveHeight-52),this.__addEventTarget({relativePos:pos,dimension,hoverText:"{{Tooltip_Start_Of_Hot_Connect_Group}}"})}}drawSlaveCouplerGroup(coupler,layers){if(!store.appearance)return void TcHmi.Log.error("Appearance is null.");const dimension=store.appearance.slaveCouplerGroup.dimension;this.__translateOrigin(layers,{x:coupler.design.dimension.width,y:0}),this.__addEventTarget({dimension,target:coupler,hoverText:`{{Tooltip_Coupler_Group_Primary_Interaction_Expand$${coupler.name}}}`,primaryPointerFn:()=>{this.__userInteracted=!0,coupler.toggleExpansion(),coupler.network.recalcNetwork(coupler)}});const ctxText=layers.getContext(LayerName.text),textPos={x:dimension.width/2,y:dimension.height/3};ctxText.fillStyle=store.appearance.slaveCouplerGroup.label.textColor.getRGBAString(),layers.saveContext(),ctxText.textAlign="center",ctxText.font=`60px ${store.appearance.fontFamily}`,ctxText.fillText(`${coupler.numOfSubSlaves}`,textPos.x,textPos.y),textPos.y+=70;const textMoreSlaves=this.__main.getLocalization().getLocalizedText("Slave_Group_More_Slaves");this.__multilineText(ctxText,textPos,textMoreSlaves,22,{width:dimension.width,height:200}),layers.restoreContext();let state=9;for(const subSlave of coupler.subSlaves){const stateValue=subSlave.onlineData.current.stateMachine.code.value;null!==stateValue&&(state=Math.min(state,stateValue))}9!==state&&this.__drawCurrentState(coupler,layers,state),this.__drawForcedState(coupler,layers,!0),this.__revertOriginTranslation(layers)}drawSlaveTerminalGroup(slaveTerminalGroup,layers){if(!store.appearance)return void TcHmi.Log.error("Appearance is null.");const pos=slaveTerminalGroup.networkPos;this.__translateOrigin(layers,pos);const ctxText=layers.getContext(LayerName.text),traceXOffset=slaveTerminalGroup.pos.networkTraceXOffset,dimension=store.appearance.slaveTerminalGroup.dimension;this.__addEventTarget({dimension,target:slaveTerminalGroup,hoverText:"{{Tooltip_EBus_Group_Primary_Interaction_Expand}}",primaryPointerFn:()=>{this.__userInteracted=!0,slaveTerminalGroup.ungroup(),slaveTerminalGroup.network.recalcNetwork()}}),this.drawFrame(dimension,layers,!0);const textPos={x:dimension.width/2,y:dimension.height/3};ctxText.fillStyle=store.appearance.slaveTerminalGroup.label.textColor.getRGBAString(),layers.saveContext(),ctxText.textBaseline="top",ctxText.textAlign="center",ctxText.font=`60px ${store.appearance.fontFamily}`,ctxText.fillText(`${slaveTerminalGroup.numOfSubSlaves}`,textPos.x,textPos.y),textPos.y+=70;const textMoreSlaves=this.__main.getLocalization().getLocalizedText("Slave_Group_More_Slaves");if(this.__multilineText(ctxText,textPos,textMoreSlaves,22,{width:dimension.width,height:200}),layers.restoreContext(),0===traceXOffset){const traceLabelPos={x:-5,y:-120},slave=slaveTerminalGroup.firstSubSlave;this.__drawTraceFlag(slave,traceLabelPos,layers)}let state=9,isSlaveNotPresent=!1,crcSumOfSubSlaves=0,crcHighestWarningLevel=0;for(const subSlave of slaveTerminalGroup.subSlaves){const stateValue=subSlave.onlineData.current.stateMachine.code.value;if(null===stateValue)continue;state=Math.min(state,stateValue),!isSlaveNotPresent&&subSlave.isNotPresent&&(isSlaveNotPresent=!0);const subSlaveCrcSum=subSlave.crcSum;subSlaveCrcSum&&(crcSumOfSubSlaves+=subSlaveCrcSum,subSlave.crcHighestWarningLevel&&(crcHighestWarningLevel=Math.max(subSlave.crcHighestWarningLevel,crcHighestWarningLevel)))}if(crcSumOfSubSlaves>0){const label={text:crcSumOfSubSlaves.toString(),warningLevel:crcHighestWarningLevel},labelPosition={x:0,y:dimension.height};this.drawErrorLabel(label,labelPosition,dimension.width,layers)}9!==state&&this.__drawCurrentState(slaveTerminalGroup,layers,state),this.__drawForcedState(slaveTerminalGroup,layers),this.__revertOriginTranslation(layers)}drawMaster(master,layers){this.__translateOrigin(layers,master.networkPos),super.drawMaster(master,layers),this.__addMasterEventTarget(master,layers),this.drawMasterFlag(master,layers),this.drawMasterPort(master,layers),this.__revertOriginTranslation(layers),this.drawMasterRedundancyPort(master,layers)}__addMasterEventTarget(master,layers){if(!store.appearance)return void TcHmi.Log.error("Appearance is null.");const network=master.network;if(!master.network)return;const ctx=layers.getContext(LayerName.text);ctx.font=`40px ${store.appearance.fontFamily}`,ctx.textBaseline="top";let hoverText=`{{Target}}: ${master.target.name}<br />\n                            {{Master}}: ${master.name}`;network.isExpand?hoverText+="{{Tooltip_Master_Pointer_Secondary_Interaction_Collapse_Ports_Of_All.margin-top-20}}":hoverText+="{{Tooltip_Master_Pointer_Secondary_Interaction_Expand_Ports_Of_All.margin-top-20}}";const dimension=master.design.dimension;this.__addEventTarget({dimension,target:master,hoverText,primaryPointerFn:()=>{master.setExtendedInfoOfMaster(new ExtendedInfoOfMaster(master))},secondaryPointerFn:()=>{this.__userInteracted=!0,master.network.toggleExpansion()}})}drawMasterPort(master,layers){const firstPort=master.ports[1];firstPort&&firstPort.isCableLink&&this.drawPort(firstPort.pos.rel,!1,0,layers)}drawMasterRedundancyPort(master,layers){const redundancyPort=master.ports[0];redundancyPort&&redundancyPort.isCableLink&&(this.drawPort(redundancyPort.pos.network,!1,0,layers),this.drawCableLinkConnectionRedundancy(redundancyPort,layers))}drawMasterFlag(master,layers){if(!store.appearance)return void TcHmi.Log.error("Appearance is null.");const network=this.__network;if(!network)return;const traceLabelPos_x=0,traceLabelPos_y=-120;let labelName=master.name,masterHasGroupedSlaves=null;if(master.topology?.traces){masterHasGroupedSlaves=master.topology.hasGroupedSlaves();labelName=`${masterHasGroupedSlaves?"+":"-"} ${labelName}`}const ctx=layers.getContext(LayerName.text),dimension=master.design.dimension,labelDimension={width:ctx.measureText(labelName).width+40,height:58};if(ctx.font=`40px ${store.appearance.fontFamily}`,ctx.textBaseline="top",ctx.beginPath(),ctx.textAlign="left",ctx.fillStyle=store.appearance.trace.label.bgColor.getRGBAString(),ctx.rect(traceLabelPos_x,traceLabelPos_y-10,5,labelDimension.height+70+dimension.height),ctx.rect(traceLabelPos_x,traceLabelPos_y-10,labelDimension.width,labelDimension.height),master.topology?.traces){let hoverText="{{Tooltip_Master_Pointer_Primary_Interaction_Collapse_EBus_Groups_Of_All_Traces}}",primaryPointerFn=()=>{master.topology?.groupAllTerminalGroups(),network.recalcNetwork()};masterHasGroupedSlaves&&(hoverText="{{Tooltip_Master_Pointer_Primary_Interaction_Expand_EBus_Groups_Of_All_Traces}}",primaryPointerFn=()=>{master.topology?.ungroupAllTerminalGroups(),network.recalcNetwork()}),this.__addEventTarget({relativePos:{x:traceLabelPos_x,y:traceLabelPos_y-10},dimension:labelDimension,target:master,hoverText,primaryPointerFn})}ctx.fill(),ctx.fillStyle=store.appearance.trace.label.textColor.getRGBAString(),ctx.fillText(labelName,traceLabelPos_x+20,traceLabelPos_y)}}customElements.define(customElementsPrefix+"drawing-network",DrawingNetwork);