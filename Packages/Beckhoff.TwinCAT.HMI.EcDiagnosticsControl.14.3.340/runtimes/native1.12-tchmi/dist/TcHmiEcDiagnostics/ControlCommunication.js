import{Communication}from"../Common/Communication.js";export class ControlCommunication extends Communication{constructor(ecDiagnostics){super(ecDiagnostics)}subscribe(commands,interval,tickCallback,initCallback){Array.isArray(commands)||(commands=[commands]);for(const command of commands)command.commandOptions=["SendErrorMessage","SendWriteValue"];const subscriptionCb={commands,interval,cmdGroup:commands.length>1,tickCallback,initCallback,errorEl:void 0},id=TcHmi.Server.subscribe(commands,interval,resultObject=>{resultObject.response?super.processReadValues_subscription(subscriptionCb,resultObject.response):TcHmi.Log.errorEx("ResultObject contains invalid response.")});return null===id?(TcHmi.Log.errorEx("Subscription returned with invalid subscription id 'null'. Unable to subscribe to symbols:",commands),null):(this.__subscriptionCallbacks.set(id,subscriptionCb),id)}unsubscribe(subscriptionId,callback){if(null!=subscriptionId){this.__unsubscribe(subscriptionId);return TcHmi.Server.unsubscribe(subscriptionId,data=>{callback&&callback(data),this.__unsubscribedSuccessfully(subscriptionId)})}return null}writeSymbol(symbol,writeValue,callback,cbErrorEl){cbErrorEl?.button?.setStateToLoading(),TcHmi.Server.writeSymbol(symbol,writeValue,data=>{const cmd=data.response?.commands?.[0];cmd&&(cmd.error&&cmd.error.code!==TcHmi.Errors.NONE?TcHmi.Log.error(`Unable to write to symbol '${symbol}'. Errordetail: ${TcHmi.Log.buildMessage(cmd.error)}`):callback&&callback(cmd.readValue))})}}