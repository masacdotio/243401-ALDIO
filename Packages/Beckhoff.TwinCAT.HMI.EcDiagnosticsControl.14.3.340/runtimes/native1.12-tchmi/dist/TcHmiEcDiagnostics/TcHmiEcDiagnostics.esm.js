var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{TcHmiControl}from"Beckhoff.TwinCAT.HMI.Framework/index.esm.js";import{EcDiagnostics}from"../Common/main.js";import{processTheming}from"../Common/Appearance.js";import{ColorRGBA}from"../Common/Color.js";import{ControlCommunication}from"./ControlCommunication.js";import{ControlLocalization}from"./ControlLocalization.js";let TcHmiEcDiagnostics=(()=>{var _a;let ___onResolverForInitTopologyViewCallback_decorators,_classSuper=TcHmiControl.Control,_instanceExtraInitializers=[];return class TcHmiEcDiagnostics extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onResolverForInitTopologyViewCallback_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],__esDecorate(this,null,___onResolverForInitTopologyViewCallback_decorators,{kind:"method",name:"__onResolverForInitTopologyViewCallback",static:!1,private:!1,access:{has:obj=>"__onResolverForInitTopologyViewCallback"in obj,get:obj=>obj.__onResolverForInitTopologyViewCallback},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}static#tchmiFQN="TcHmi.Controls.Beckhoff."+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs)}__ecDiagnostics=__runInitializers(this,_instanceExtraInitializers);__loadTemplatePromise=null;__device;__allowZoomAndPan;__toolboxResetView;__experimentalMode;__initTopologyView=void 0;__elementTemplateRoot;__previnit(){this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiEcDiagnostics");const commonPath=TcHmi.Environment.getControlBasePathEx(this)+"/",config={device:this.__device??"",allowZoomAndPan:this.__allowZoomAndPan??!1,toolboxResetView:this.__toolboxResetView??!1,experimentalMode:this.__experimentalMode??!1,initTopologyViewPosX:0,initTopologyViewPosY:0,initTopologyViewZoom:null},rootEl=this.__elementTemplateRoot.get(0);if(!rootEl)return void TcHmi.Log.error("Can not find root element this.__elementTemplateRoot.get(0)");const ecDiagnosticsMain=rootEl.querySelector("beckhoff-ec-diagnostics");if(!ecDiagnosticsMain)return void TcHmi.Log.error("Can not find element <beckhoff-ec-diagnostics></beckhoff-ec-diagnostics>");const localization=new ControlLocalization(this.__localization);null!==commonPath?(this.__ecDiagnostics=new EcDiagnostics(ecDiagnosticsMain,localization,commonPath,config,{add:this.addTopMostLayer.bind(this),remove:this.removeTopMostLayer.bind(this)}),this.__updateTheme(),TCHMI_UNITTEST_MODE||(this.__loadTemplatePromise=this.__ecDiagnostics.loadTemplates().then(()=>{const comObj=new ControlCommunication(this.__ecDiagnostics);return this.__ecDiagnostics.comObj=comObj,Promise.resolve()})),super.__previnit()):TcHmi.Log.error("BaseDir is not defined.")}__init(){super.__init()}__themeDataChangedDestroyFn;__attach(){this.__loadTemplatePromise?.then(()=>{this.__themeDataChangedDestroyFn=TcHmi.EventProvider.register("onThemeDataChanged",()=>{this.__updateTheme(),this.__ecDiagnostics.reload()}),this.__ecDiagnostics.preInit(!TCHMI_DESIGNER)}),super.__attach()}resetView(){this.__ecDiagnostics?.resetView()}addTopMostLayer(element){TcHmi.TopMostLayer.add(this,element,{dimBackground:!1,closeOnBackground:!1,modal:!1})}removeTopMostLayer(element){TcHmi.TopMostLayer.remove(this,element)}__updateTheme(){const description=TcHmi.Controls.getDescription(this.getType());if(!description)return void TcHmi.Log.error("Unable to read description.");const themedResources=description.themedResources,themeEntry={};for(const themedResource of themedResources){const themed=TcHmi.Theme.Resources.get(this,themedResource.name);let themeEntryChild=themeEntry;const resourcePath=themedResource.name.split("/"),resourceName=resourcePath.pop();if(!resourceName)break;for(const subPath of resourcePath)themeEntryChild.hasOwnProperty(subPath)||(themeEntryChild[subPath]={}),themeEntryChild=themeEntryChild[subPath];let themedValue=themed.value;null!==themedValue?(themedValue.hasOwnProperty("color")&&(themedValue=ColorRGBA.resolveSolidColorAsRGBA(themed.value)),themeEntryChild[resourceName]=themedValue,processTheming(themeEntry)):TcHmi.Log.warn(`No themed value for ${themedResource.name}`)}}__detach(){this.__themeDataChangedDestroyFn?.(),this.__themeDataChangedDestroyFn=void 0,this.__ecDiagnostics.comObj?.unsubscribeAll(),this.__ecDiagnostics.cleanUp(),super.__detach()}destroy(){this.__keepAlive||(this.__ecDiagnostics.destroy(),super.destroy())}setDevice(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);if(null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Device")),convertedValue===this.__device)return;this.__device=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Device"});const executeInitOnSuccess=!TCHMI_DESIGNER&&this.__isAttached;this.__ecDiagnostics.updateConfigDevice(this.__device,executeInitOnSuccess),this.__processEcDiagnosticsConfig()}getDevice(){return this.__device}setAllowZoomAndPan(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);if(null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AllowZoomAndPan")),convertedValue===this.__allowZoomAndPan)return;this.__allowZoomAndPan=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowZoomAndPan"});const executeInitOnSuccess=!TCHMI_DESIGNER&&this.__isAttached;this.__ecDiagnostics.updateConfigAllowZoomAndPan(this.__allowZoomAndPan,executeInitOnSuccess)}getAllowZoomAndPan(){return this.__allowZoomAndPan}setToolboxResetView(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);if(null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ToolboxResetView")),convertedValue===this.__toolboxResetView)return;this.__toolboxResetView=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ToolboxResetView"});const executeInitOnSuccess=!TCHMI_DESIGNER&&this.__isAttached;this.__ecDiagnostics.updateConfigToolboxResetView(this.__toolboxResetView,executeInitOnSuccess)}getToolboxResetView(){return this.__toolboxResetView}setExperimentalMode(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);if(null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ExperimentalMode")),convertedValue===this.__experimentalMode)return;this.__experimentalMode=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ExperimentalMode"});const executeInitOnSuccess=!TCHMI_DESIGNER&&this.__isAttached;this.__ecDiagnostics.updateConfigExperimentalMode(this.__experimentalMode,executeInitOnSuccess)}getExperimentalMode(){return this.__experimentalMode}__processEcDiagnosticsConfig(){if(TCHMI_DESIGNER){const localization=this.__ecDiagnostics.getLocalization(),designerMessage=this.__element.find(".tchmi-designer-control-message")[0]??document.createElement("div");designerMessage.classList.add("tchmi-designer-control-message"),designerMessage.innerHTML="Engineering_Not_Configured",this.__element[0].appendChild(designerMessage),this.__device?localization.addElement(designerMessage,"Engineering_Device",[this.__device]):localization.addElement(designerMessage,"Engineering_Device_Not_Configured")}}setInitTopologyView(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("InitTopologyView"));const resolverInfo=this.__objectResolvers.get("initTopologyView");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());const resolver=new TcHmi.Symbol.ObjectResolver(convertedValue,{parentControl:this,type:this.getAttributeDescription("InitTopologyView")?.type});this.__objectResolvers.set("initTopologyView",{resolver,watchCallback:this.__onResolverForInitTopologyViewCallback,watchDestroyer:resolver.watch(this.__onResolverForInitTopologyViewCallback)})}__onResolverForInitTopologyViewCallback(data){if(this.__isAttached||this.__suspendObjectResolver("initTopologyView"),data.error!==TcHmi.Errors.NONE)return void TcHmi.Log.Controls.error(this,TcHmiEcDiagnostics.#tchmiFQN,{Attribute:"InitTopologyView"},`Resolving symbols from object failed with error: ${TcHmi.Log.buildMessage(data.details)}`);if(tchmi_equal(data.value,this.__initTopologyView))return;this.__initTopologyView=data.value;const value={pos:{x:data.value?.posX??0,y:data.value?.posY??0},zoom:data.value?.zoom?data.value.zoom/100:null};TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"InitTopologyView"});const executeInitOnSuccess=!TCHMI_DESIGNER;this.__ecDiagnostics.updateConfigInitTopology(value,executeInitOnSuccess)}getInitTopologyView(){return this.__initTopologyView}}})();TcHmi.Controls.registerEx("TcHmiEcDiagnostics","TcHmi.Controls.Beckhoff",TcHmiEcDiagnostics,{injectInGlobalObject:!0});export{TcHmiEcDiagnostics as Control};